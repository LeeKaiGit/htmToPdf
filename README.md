# MHT2PDF 转换工具

![Python](https://img.shields.io/badge/python-3.10-blue.svg)
![License](https://img.shields.io/badge/license-MIT-green.svg)
![Language](https://img.shields.io/badge/language-Python-blue.svg)

一个专为个人信息文档设计的 MHT/HTML 到 PDF 批量转换工具,基于 PyQt5 和 QtWebEngine 开发.

## 项目简介

MHT2PDF 是一个专业的个人文档格式转换工具,专门用于将各类个人信息的 MHT (MHTML) 和 HTML 文件高质量地转换为 PDF 文档.该工具特别适用于转换体检报告、成绩单、证书、账单、健康档案等各类个人重要文档,提供友好的图形用户界面,支持单文件转换和批量转换两种模式,帮助您轻松将散乱的网页存档文件统一转换为便于保存和打印的 PDF 格式.

## 典型应用场景

- **医疗健康**: 体检报告、病历记录、检查结果、疫苗接种记录
- **教育培训**: 学校成绩单、考试成绩、学习证明、培训证书
- **金融财务**: 银行账单、交易记录、电子发票、保险单据
- **证件证书**: 各类电子证书、资格证明、荣誉证书
- **政务服务**: 社保查询、公积金记录、政务办事记录
- **其他文档**: 任何需要保存或打印的网页存档文件

## 核心功能

### 单文件转换模式
- 支持导入单个 MHT 或 HTML 文件
- 实时预览文件内容
- 可视化网页渲染效果
- 一键导出为标准 PDF 格式
- 进度条显示转换状态

### 批量转换模式
- 支持同时选择多个 MHT/MHTML 文件
- 支持选择文件夹批量导入
- 可选择是否包含子文件夹
- 自动保持原有文件夹结构
- 转换完成后可选删除原始文件
- 详细的转换日志记录
- 实时显示转换进度和状态

### 文件处理特性
- 自动解码 Quoted-Printable 编码
- Base64 图片资源处理
- 支持嵌入式资源提取
- 自动处理中文编码
- 智能 A4 页面布局优化
- 表格和图片自动适配

## 支持的 MHT 文件样式

本工具能够转换包含以下内容和样式的 MHT 文件:

### 文本内容
- 标准文本段落,支持各种字体和字号
- 标题样式 (H1-H6)
- 加粗,斜体,下划线等文本装饰
- 上标,下标文本
- 列表 (有序列表,无序列表,嵌套列表)
- 引用块和代码块

### 表格样式
- 标准 HTML 表格
- 带边框和无边框表格
- 单元格合并 (rowspan, colspan)
- 表格背景色和边框样式
- 嵌套表格
- 表头和表体样式
- 自动适配 A4 页面宽度

### 图片和媒体
- Base64 编码的内嵌图片
- JPG, PNG, GIF, BMP 等常见图片格式
- 图片尺寸自动缩放适配页面
- 图片对齐方式 (左对齐,居中,右对齐)
- 图文混排布局

### CSS 样式
- 内联样式 (inline style)
- 内部样式表 (style 标签)
- 文本颜色和背景色
- 边距和内边距 (margin, padding)
- 边框样式和圆角
- 字体系列,大小,粗细
- 文本对齐和行高
- 基本的 Flexbox 和 Grid 布局

### 页面布局
- 响应式布局自动适配
- 多列布局
- 浮动元素
- 绝对定位和相对定位
- 分页控制优化

### 特殊元素
- 超链接 (转换为 PDF 中的可点击链接)
- 水平分割线
- 块引用
- 预格式化文本
- 表单元素 (仅显示外观,不保留交互功能)

### 编码支持
- UTF-8, GBK, GB2312 等中文编码
- Quoted-Printable 编码自动解码
- Base64 编码资源自动解码
- Unicode 字符完整支持

### 已知限制
- 不支持 JavaScript 动态生成的内容
- Flash, ActiveX 等插件内容无法显示
- 音频和视频仅显示占位符
- 复杂 CSS3 动画和变换可能失效
- iframe 嵌套内容可能显示不完整
- 过于复杂的页面布局可能需要调整

## 技术架构

### 开发语言
- Python 3.x

### 核心依赖
- **PyQt5**: 提供图形用户界面框架
- **PyQtWebEngine**: 提供网页渲染引擎,用于 HTML 内容的高质量渲染

### 主要技术特点
- 基于 Qt WebEngine 的高保真网页渲染
- 多线程批量处理机制
- 临时文件管理和自动清理
- 信号槽机制实现异步操作
- QPrinter 实现 PDF 打印输出

## 项目结构

```
htmToPdf/
├── 2PDF.py                 # 主程序文件
├── requirements.txt        # Python 依赖列表
├── MHT2PDF.spec           # PyInstaller 打包配置文件
├── pdf.ico                # 程序图标(如存在)
└── build/                 # 构建输出目录
    └── MHT2PDF/           # 编译后的可执行文件
```

## 安装说明

### 环境要求
- Python 3.6 或更高版本
- Windows 操作系统(推荐)

### 依赖安装

1. 克隆或下载项目到本地
```bash
cd htmToPdf
```

2. 安装依赖包
```bash
pip install -r requirements.txt
```

## 使用方法

### 运行 Python 脚本
```bash
python 2PDF.py
```

### 使用可执行文件
如果已打包为可执行文件,直接运行 `MHT2PDF.exe`

### 单文件转换流程
1. 切换到"单文件转换"选项卡
2. 点击"导入 MHT/HTML 文件"按钮
3. 选择要转换的文件
4. 预览文件内容
5. 点击"导出为 PDF"按钮
6. 选择保存位置和文件名

### 批量转换流程
1. 切换到"批量转换"选项卡
2. 选择文件方式:
   - 点击"选择多个 MHT 文件"直接选择多个文件
   - 点击"选择文件夹"批量导入文件夹中的所有 MHT 文件
3. 勾选"包含子文件夹"可递归搜索子目录
4. (可选)点击"选择输出目录"自定义输出位置
5. (可选)勾选"转换完成后删除原始 MHT 文件"
6. 点击"开始批量转换"按钮
7. 等待转换完成,查看转换日志

## 功能特性详解

### MHT 文件预处理
- 自动解析 MHT 文件的 MIME 结构
- 识别和处理 Content-Transfer-Encoding
- 提取嵌入的图片和样式资源
- 转换为标准 HTML 临时文件

### PDF 输出优化
- 自动 A4 纸张大小适配
- 边距优化(1cm 上下,1.5cm 左右)
- 表格宽度自动调整
- 文本换行和分页优化
- 图片尺寸智能缩放

### 批量处理机制
- 异步处理避免界面卡死
- 自动保持目录结构
- 失败文件统计和报告
- 可选择原文件删除策略

## 打包说明

项目使用 PyInstaller 进行打包,配置文件为 `MHT2PDF.spec`

### 打包命令
```bash
pyinstaller MHT2PDF.spec
```

### 打包特性
- 单文件可执行程序
- 嵌入程序图标
- 无控制台窗口
- 包含必要的资源文件
- UPX 压缩减小体积

## 注意事项

1. **资源占用**: 批量转换大量文件时会占用较多内存,建议分批处理
2. **文件编码**: 程序会自动处理常见编码,但某些特殊编码可能需要手动转换
3. **原文件删除**: 使用"删除原始文件"功能时请确保转换成功后再删除
4. **临时文件**: 程序会在系统临时目录创建临时文件,转换完成后自动清理
5. **网页复杂度**: 过于复杂的网页可能需要更长的渲染时间

## 常见问题

### Q: 转换的 PDF 排版错乱?
A: 这可能是由于原始 HTML 的样式问题,程序已内置页面优化,但某些特殊样式可能需要手动调整.

### Q: 批量转换时程序无响应?
A: 批量转换是逐个处理的,请耐心等待.可以查看转换日志了解当前进度.

### Q: 图片没有显示在 PDF 中?
A: 检查原始 MHT 文件中的图片是否正确嵌入,程序支持 Base64 编码的图片.

### Q: 如何保留原有的文件夹结构?
A: 在批量转换时不勾选"包含子文件夹"选项,程序会自动在输出目录中保持原有结构.

## 系统要求

- 操作系统: Windows 7/8/10/11
- 内存: 至少 2GB RAM
- 磁盘空间: 至少 100MB 可用空间
- 显示器: 建议分辨率 1280x720 或更高

## 版本信息

- 当前版本: 1.0
- 开发者: https://github.com/LeeKaiGit

## 许可证

本项目采用 MIT 许可证. 详见 [LICENSE](LICENSE) 文件.

## 更新日志

### Version 1.0
- 初始版本发布
- 支持单文件和批量转换
- 实现 MHT 文件解析
- A4 页面优化
- 批量处理机制
- 图形用户界面

## 技术支持

如遇到问题或有改进建议,欢迎提出 Issue 或 Pull Request.

## 开发说明

### 代码结构
- `HTMLtoPDFConverter`: 主窗口类,管理整体界面
- `BatchConverter`: 批量转换线程类(预留扩展)
- MHT 文件解析使用 `quopri` 和 `base64` 模块
- PDF 生成使用 `QPrinter` 和 `QWebEngineView`

### 关键方法
- `preprocess_mht_file()`: MHT 文件预处理
- `export_pdf()`: 单文件 PDF 导出
- `process_batch_files()`: 批量文件处理
- `inject_rendering_improvements()`: 页面渲染优化

## 贡献指南

欢迎贡献代码、报告 Bug 或提出功能建议.提交 Pull Request 前请确保代码风格一致并测试通过.
